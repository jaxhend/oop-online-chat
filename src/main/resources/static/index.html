<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #log { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; }
        #msgInput { margin-top: 10px; width: calc(100% - 100px); }
        button { padding: 5px 10px; }
    </style>
</head>
<body>

<h2>Online-chat</h2>
<div id="log"></div>

<input id="msgInput" placeholder="Sisesta midagi..." />
<button onclick="send()">Saada</button>

<script>
    let socket;
    const sessionId = crypto.randomUUID();

    function log(msg) {
        const line = document.createElement("div");
        line.textContent = msg;
        document.getElementById("log").appendChild(line);
        document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight;
    }

    function connect() {
        const protocol = location.protocol === 'https:' ? 'wss://' : 'ws://';
        const url = protocol + location.host + '/ws?sessionId=' + sessionId;
        socket = new WebSocket(url);

        socket.onopen = () => {
            log('Ühendus loodud.');
            log('Tere tulemast! Sisesta enda kasutajanimi:');
        };

        socket.onmessage = e => {
            log(e.data);
        };

        socket.onerror = err => log('Viga: ' + err.message);
        socket.onclose = ev => log('Ühendus suleti: kood ' + ev.code);
    }

    function send() {
        const input = document.getElementById("msgInput");
        const text = input.value.trim();
        if (!text) return;

        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(text);
            input.value = '';
        } else {
            log('WebSocket pole ühendatud.');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        connect();
    });
</script>

</body>
</html>